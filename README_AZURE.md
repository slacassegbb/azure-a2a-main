# Azure Services Setup Guide

This guide documents the Azure resources that the current A2A stack actually relies on. Azure Event Hub is **not** required for the existing deployment and is omitted here.

Each section lists the environment variables you must populate in `.env` / `.env.example`, followed by concise steps to create the resource in the Azure Portal.

---

## 1. Azure AI Foundry Project
Used by the host agents to invoke Azure AI Foundry (aka Azure OpenAI on Foundry) models such as `gpt-4o`.

**Required variables:**
- `AZURE_AI_FOUNDRY_PROJECT_ENDPOINT`
- `AZURE_AI_AGENT_MODEL_DEPLOYMENT_NAME`
- `AZURE_OPENAI_GPT_API_BASE`
- `AZURE_OPENAI_GPT_API_KEY`
- `AZURE_OPENAI_GPT_API_VERSION`
- `AZURE_OPENAI_GPT_DEPLOYMENT`

**Portal steps:**
1. Sign in to [https://ai.azure.com](https://ai.azure.com) and open your project (or create a new one).
2. Deploy `gpt-4o` (or the model of your choice) under **Build → Deployments**.
3. Open **Project settings → Keys & endpoints**, copy the REST endpoint and key, and map them to the variables above.

---

## 2. Azure OpenAI Resource (Embeddings)
Drives embedding creation for the A2A memory service.

**Required variables:**
- `AZURE_OPENAI_EMBEDDINGS_ENDPOINT`
- `AZURE_OPENAI_EMBEDDINGS_DEPLOYMENT`
- `AZURE_OPENAI_EMBEDDINGS_KEY`

**Portal steps:**
1. In the Azure Portal, create an **Azure OpenAI** resource (or reuse the one backing your Foundry project).
2. Deploy the embedding model (e.g., `text-embedding-3-large`).
3. Copy the deployment endpoint and key from the **Keys & Endpoint** blade and update `.env`.

---

## 3. Azure AI Search (Cognitive Search)
Stores semantic memories so users and agents can retrieve past interactions.

**Required variables:**
- `AZURE_SEARCH_SERVICE_ENDPOINT`
- `AZURE_SEARCH_SERVICE_NAME`
- `AZURE_SEARCH_ADMIN_KEY`
- `AZURE_SEARCH_INDEX_NAME`
- `AZURE_SEARCH_VECTOR_DIMENSION` (match your embedding model dimension, e.g., 3072 for `text-embedding-3-large`).

**Portal steps:**
1. Create an **Azure AI Search** service (Basic SKU is sufficient for demos).
2. From **Keys**, copy an admin key and the service URL.
3. Either let the app auto-create the index or create an index manually and supply its name.

---

## 4. Azure Storage Account (Blob)
Stores uploaded documents and artifacts generated by agents.

**Required variables:**
- `AZURE_STORAGE_CONNECTION_STRING`
- `AZURE_STORAGE_ACCOUNT_NAME`
- `AZURE_BLOB_CONTAINER`
- Optional: `AZURE_BLOB_SIZE_THRESHOLD`, `FORCE_AZURE_BLOB`

**Portal steps:**
1. Create a **Storage Account** (General Purpose v2).
2. In **Security + networking → Access keys**, copy a connection string.
3. Under **Data storage → Containers**, create a container named `a2a-files` (or your preferred value) and update `.env` accordingly.

---

## 5. Application Insights (optional)
Provides telemetry for the Python backend. Leave the variable blank to disable it locally.

**Optional variable:**
- `APPLICATIONINSIGHTS_CONNECTION_STRING`

**Portal steps:**
1. Create an **Application Insights** resource.
2. Copy the connection string from the overview page and add it to `.env` if you want telemetry.

---

## 6. Azure Identity / Authentication (optional overrides)
By default, the backend uses Azure CLI credentials. When deploying to Azure, configure either managed identity or a service principal.

**Optional variables:**
- `AZURE_TENANT_ID`
- `AZURE_CLIENT_ID`
- `AZURE_CLIENT_SECRET`

**Guidance:**
- **Managed identity:** Assign the identity to your compute (e.g., Azure Container Apps) and give it the proper roles on Search, Storage, and OpenAI.
- **Service principal:** Create an App Registration, generate a client secret, grant roles, and populate the three variables above.

---

## Quick Reference Table
| Service | Mandatory? | Purpose |
|---------|------------|---------|
| Azure AI Foundry Project | Yes | Hosts GPT model used by the orchestration agents |
| Azure OpenAI (Embeddings) | Yes (for memory) | Generates semantic embeddings |
| Azure AI Search | Yes (for memory) | Persists vectorized conversation history |
| Azure Storage Account | Yes | Stores uploaded files/artifacts |
| Application Insights | Optional | Backend telemetry |
| Managed Identity / Service Principal | Optional | Auth when running inside Azure |

Populate the corresponding variables in `.env` with the values from Azure. In local development you can leave optional entries blank—the application falls back to in-memory / mock behavior without them.

